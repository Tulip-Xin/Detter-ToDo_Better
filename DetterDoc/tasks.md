# 实施计划

- [x] 1. 项目初始化与基础架构搭建
  - 使用React Native CLI创建新项目，配置Android开发环境
  - 安装核心依赖：react-navigation、react-native-sqlite-storage、react-native-reanimated、react-native-gesture-handler
  - 创建项目目录结构（components、screens、services、models、utils、contexts）
  - 配置TypeScript和ESLint
  - _需求: 1.1, 16.1, 16.3_

- [x] 2. 数据层实现

- [x] 2.1 实现DatabaseService
  - 编写DatabaseService类，实现数据库初始化、表创建和事务管理
  - 创建tasks和reflections表，添加必要的索引
  - 实现数据库连接管理和错误处理
  - _需求: 15.1, 15.2, 15.3_

- [x] 2.2 实现TaskService
  - 编写TaskService类，实现任务的CRUD操作
  - 实现getTasksByDate方法，支持按日期查询任务
  - 实现getCompletedTasks方法，支持查询已完成任务
  - 实现批量更新任务顺序的方法
  - _需求: 15.2, 15.4_

- [x] 2.3 实现ReflectionService
  - 编写ReflectionService类，实现复盘笔记的CRUD操作
  - 实现关联查询，获取任务及其复盘笔记
  - _需求: 15.3_

- [x] 3. 状态管理与Context实现

- [x] 3.1 实现TaskContext
  - 创建TaskContext和TaskProvider
  - 实现taskReducer处理任务状态变化
  - 实现loadTasks、addTask、updateTask、deleteTask等方法
  - 实现selectedDate状态管理
  - _需求: 2.5, 4.3, 4.4, 5.1_

- [x] 3.2 实现ThemeContext
  - 创建ThemeContext和ThemeProvider
  - 定义lightTheme和darkTheme配置
  - 实现主题切换逻辑，支持跟随系统
  - _需求: 13.1, 13.2_

- [x] 4. 导航结构实现
  - 配置React Navigation的Bottom Tab Navigator
  - 创建三个主Tab：TaskScreen（行）、ReflectionScreen（思）、ProfileScreen（我）
  - 配置Stack Navigator用于详情页导航
  - 设置全局背景色#ecfaf6和Tab栏样式
  - 实现Tab切换动画，确保响应时间在100ms内
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 5. 通用组件实现

- [x] 5.1 实现DateSelector组件
  - 创建横向滚动的日期选择器，使用FlatList实现
  - 实现日期项的垂直布局（星期+日期）
  - 应用背景色#f5eefb
  - 实现今天日期的高亮显示
  - 实现日期点击切换和滚动加载前后周数据
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 5.2 实现Calendar组件
  - 创建日历视图，显示7列的日期网格
  - 实现月份导航，支持左右滑动切换月份
  - 集成农历显示（使用lunar-javascript库）
  - 实现今天日期的特殊标记和"今"字显示
  - _需求: 6.4, 6.5, 6.6_

- [x] 5.3 实现BottomSheet组件
  - 使用@gorhom/bottom-sheet库创建底部弹出面板
  - 配置snapPoints为50%和90%
  - 实现打开时自动弹起键盘并聚焦标题输入框
  - 实现关闭动画和背景遮罩
  - _需求: 6.1, 6.2_

- [x] 6. 任务管理模块UI实现

- [x] 6.1 实现PriorityContainer组件
  - 创建三个优先级容器：重要、紧急、琐事
  - 应用背景色#f0f0f0和对应的左边框颜色（重要#dc663c、紧急#eb9e28、琐事#8c8c8c）
  - 实现空状态占位符"点击添加ToDo"
  - 实现点击占位符打开BottomSheet并预选优先级
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [x] 6.2 实现TaskItem组件
  - 创建任务项布局：左侧复选框+中间任务信息
  - 实现复选框显示优先级数字
  - 实现任务标题、描述和标签的显示样式
  - 实现点击复选框标记完成的视觉变化（填充、对勾、删除线、透明度）
  - 实现点击任务项导航到编辑页面
  - _需求: 4.1, 4.2, 4.3, 4.4, 5.1_

- [x] 6.3 实现TaskItem手势交互
  - 使用react-native-gesture-handler实现左滑显示操作菜单
  - 实现操作按钮：归档、删除、上移、下移
  - 实现长按拖拽排序，使用react-native-draggable-flatlist
  - 实现拖拽时实时更新优先级数字
  - _需求: 5.2, 5.3, 5.5, 5.6_

- [x] 6.4 实现TaskBoard组件
  - 组合三个PriorityContainer形成任务看板
  - 实现下拉刷新功能
  - 实现任务按优先级和顺序排序
  - 集成DateSelector和TaskBoard
  - _需求: 3.1, 5.4_

- [x] 7. 添加任务功能实现

- [x] 7.1 实现任务添加面板UI
  - 在BottomSheet中实现日期快捷选择按钮（今、明、日历）
  - 实现任务标题和描述输入框
  - 实现优先级按钮组（重要、紧急、琐事）
  - 实现底部工具栏（闹钟图标、#图标）
  - 实现右上角"添加"按钮，标题填写后启用
  - _需求: 6.3, 6.7, 6.10, 6.11, 6.13_

- [x] 7.2 实现子任务功能
  - 创建SubTaskList组件
  - 实现子任务输入框，占位符"添加子任务"
  - 实现按回车或点击"+"添加子任务
  - 实现子任务列表显示，带复选框和删除按钮
  - _需求: 6.8, 6.9_

- [x] 7.3 实现标签输入功能
  - 实现点击#图标在描述框插入#符号
  - 从数据库查询已有标签
  - 实现标签建议列表
  - 实现标签的胶囊样式显示
  - _需求: 6.12_

- [x] 7.4 实现提醒时间选择
  - 实现24小时制时间选择器
  - 集成到BottomSheet中
  - 保存提醒时间到任务数据
  - _需求: 6.11_

- [x] 7.5 实现任务保存逻辑
  - 实现表单验证（标题必填）
  - 调用TaskService创建任务
  - 更新TaskContext状态
  - 关闭BottomSheet并刷新任务列表
  - _需求: 6.14_

- [x] 8. 任务完成与复盘功能

- [x] 8.1 实现任务完成流程
  - 实现点击复选框更新任务完成状态
  - 实现完成动画（300ms延迟）
  - 弹出复盘输入面板，占位符"如何Do Better？"
  - 实现可选输入或关闭面板
  - _需求: 4.3, 4.4, 4.5, 4.6_

- [x] 8.2 实现即时复盘保存
  - 实现复盘内容输入
  - 调用ReflectionService保存复盘笔记
  - 关联复盘笔记到已完成任务
  - _需求: 4.6_

- [x] 9. 复盘模块实现

- [x] 9.1 实现ReflectionScreen主界面
  - 创建顶部Tab切换（卡片列表、清单列表）
  - 实现Tab切换动画，响应时间<100ms
  - 实现右上角搜索图标
  - 筛选显示已完成的任务
  - _需求: 7.1, 7.2, 7.3, 7.4_

- [x] 9.2 实现ChecklistView组件
  - 使用FlatList实现单列列表
  - 按完成日期降序排序
  - 显示任务标题、完成日期、标签
  - 有复盘笔记的任务应用背景色#f2f2fd
  - 实现点击任务导航到复盘详情页
  - _需求: 10.1, 10.2, 10.3, 10.4_

- [x] 9.3 实现CardListView组件核心逻辑
  - 使用Animated.ScrollView实现滚动容器
  - 使用useSharedValue管理scrollY状态
  - 实现useAnimatedScrollHandler监听滚动事件
  - 创建ReflectionCard组件作为卡片项
  - _需求: 9.1_

- [x] 9.4 实现卡片动态缩放效果
  - 在ReflectionCard中使用useAnimatedStyle计算缩放
  - 实现距离屏幕中心的距离计算
  - 使用interpolate将距离映射到缩放值（1.0-0.8）
  - 确保缩放动画平滑无跳动
  - _需求: 9.2, 9.3, 9.4_

- [x] 9.5 实现自动居中对齐（Snap-to-Center）
  - 实现onMomentumEnd回调
  - 计算最接近屏幕中心的卡片索引
  - 使用scrollTo平滑滚动到目标位置
  - 应用减速插值器实现吸附效果
  - _需求: 9.5_

- [x] 9.6 实现惯性滑动控制
  - 使用useAnimatedGestureHandler处理手势
  - 根据velocity计算惯性滚动距离
  - 限制最大滚动3张卡片
  - 实现边界回弹效果
  - _需求: 9.6, 9.7_

- [x] 9.7 优化CardListView性能
  - 实现虚拟化渲染，只渲染可见卡片
  - 使用React.memo优化ReflectionCard
  - 确保60fps流畅滚动
  - _需求: 14.3_

- [x] 10. 复盘详情功能实现

- [x] 10.1 实现ReflectionDetailScreen
  - 创建复盘详情页面
  - 顶部显示任务标题、描述、标签、完成日期
  - 实现复盘内容输入区，占位符"思：这次做得怎么样？下次如何做得更好？"
  - 右上角显示"保存"按钮
  - _需求: 8.1, 8.2, 8.3, 8.4_

- [x] 10.2 实现复盘保存逻辑
  - 实现保存按钮点击事件
  - 调用ReflectionService保存或更新复盘笔记
  - 更新任务的复盘状态
  - 返回复盘列表并刷新
  - _需求: 8.5, 8.6_

- [x] 11. 搜索与筛选功能实现

- [x] 11.1 实现搜索功能
  - 实现搜索输入框UI
  - 实现关键词匹配逻辑（标题、描述、标签、复盘内容）
  - 实现实时搜索结果更新
  - _需求: 11.1, 11.2_

- [x] 11.2 实现筛选功能
  - 创建筛选面板UI
  - 实现日期范围筛选
  - 实现标签筛选（多选）
  - 实现复盘状态筛选（已思/待思）
  - 实现筛选条件组合逻辑
  - _需求: 11.3, 11.4_

- [x] 11.3 实现清除搜索和筛选
  - 实现清除按钮
  - 恢复完整任务列表
  - _需求: 11.5_

- [x] 12. 个人中心模块实现

- [x] 12.1 实现数据统计功能
  - 实现完成率统计计算逻辑（每日/每周/每月）
  - 使用react-native-chart-kit创建完成率图表
  - 实现任务分布统计（重要且紧急、重要、紧急、琐事、无标识）
  - 创建任务分布饼图或柱状图
  - 实现复盘习惯统计（已复盘/已完成比率）
  - 实现统计数据实时更新
  - _需求: 12.1, 12.2, 12.3, 12.4_

- [x] 12.2 实现主题切换功能
  - 创建主题设置UI（浅色/深色/跟随系统）
  - 实现主题切换逻辑
  - 应用主题到所有屏幕
  - 持久化主题设置
  - _需求: 13.1, 13.2_

- [x] 12.3 实现通知设置
  - 创建通知开关UI
  - 实现通知权限请求
  - 集成NotificationService（基础实现）
  - _需求: 13.3_

- [x] 12.4 实现数据导出功能
  - 实现导出为JSON格式
  - 实现导出为CSV格式
  - 使用react-native-fs保存文件到本地
  - 实现文件分享功能
  - _需求: 13.4_

- [x] 12.5 实现数据导入功能
  - 实现文件选择器
  - 实现数据格式验证
  - 实现批量导入逻辑
  - 处理导入错误和冲突
  - _需求: 13.5_

- [x] 12.6 实现数据清空功能
  - 创建清空数据按钮
  - 实现确认对话框
  - 调用DatabaseService清空所有数据
  - _需求: 13.6, 13.7_

- [x] 12.7 实现关于和帮助页面
  - 显示应用名称、版本号、开发者信息
  - 提供帮助指导内容
  - 提供反馈联系方式
  - _需求: 13.8, 13.9_

- [x] 13. 任务编辑功能实现
  - 创建TaskEditScreen页面
  - 复用BottomSheet组件逻辑
  - 预填充现有任务数据
  - 实现更新任务逻辑
  - 实现删除任务功能（带确认）
  - _需求: 5.1_

- [x] 14. 通知服务实现（基础版）
  - 创建NotificationService类
  - 实现本地通知调度
  - 实现任务提醒通知
  - 处理通知权限
  - _需求: 13.3_

- [x] 15. 错误处理与用户体验优化

- [x] 15.1 实现全局错误处理
  - 创建ErrorBoundary组件
  - 实现AppError类和错误类型定义
  - 实现错误日志记录
  - 创建友好的错误提示UI
  - _需求: 14.2_

- [x] 15.2 实现加载状态
  - 创建Loading组件
  - 在数据加载时显示加载指示器
  - _需求: 14.2_

- [x] 15.3 实现空状态提示
  - 为各个列表创建空状态UI
  - 提供引导性文案和操作建议
  - _需求: 3.5_

- [x] 16. 性能优化

- [x] 16.1 实现启动优化
  - 集成react-native-splash-screen
  - 实现数据预加载
  - 优化应用启动流程
  - 确保冷启动时间小于2秒
  - _需求: 14.1_

- [x] 16.2 实现列表性能优化
  - 优化FlatList配置（windowSize、maxToRenderPerBatch）
  - 使用React.memo优化组件
  - 使用useMemo和useCallback避免重复计算
  - 确保列表滚动流畅60fps
  - _需求: 14.3, 14.4_

- [x] 16.3 实现动画性能优化
  - 确保所有动画使用react-native-reanimated在UI线程执行
  - 优化动画计算逻辑
  - 测试动画帧率
  - _需求: 14.3_

- [x] 17. 样式与主题完善
  - 实现全局样式常量（颜色、字体、间距）
  - 完善所有组件的样式细节
  - 确保符合设计规范（极简风、Bento Grid）
  - 适配不同屏幕尺寸
  - _需求: 1.3, 16.2_

- [x] 18. Android平台适配与打包

- [x] 18.1 配置Android权限
  - 在AndroidManifest.xml中添加必要权限
  - 实现运行时权限请求
  - _需求: 16.4_

- [x] 18.2 配置应用签名
  - 生成release keystore
  - 配置build.gradle签名配置
  - _需求: 16.3_

- [x] 18.3 优化APK大小
  - 启用ProGuard代码混淆
  - 配置资源压缩
  - 移除未使用的资源
  - _需求: 16.3_

- [x] 18.4 构建Release APK
  - 执行./gradlew assembleRelease
  - 测试APK安装和运行
  - 验证所有功能正常
  - _需求: 16.3_

- [x] 19. 测试

- [x] 19.1 编写单元测试
  - 为DatabaseService编写测试
  - 为TaskService和ReflectionService编写测试
  - 为工具函数编写测试
  - 确保核心业务逻辑测试覆盖率>80%+
  - _需求: 所有数据层需求_

- [ ] 19.2 编写组件测试
  - 为TaskItem、PriorityContainer等核心组件编写测试
  - 测试组件交互和状态变化
  - 确保UI组件测试覆盖率>70%+
  - _需求: 所有UI相关需求_

- [ ] 19.3 编写集成测试
  - 测试完整的任务创建流程
  - 测试任务完成和复盘流程
  - 测试数据导入导出流程
  - _需求: 关键用户流程_

- [ ] 19.4 性能测试
  - 测试应用启动时间
  - 测试大数据量下的列表性能
  - 测试动画帧率
  - 使用React Native Performance Monitor监控
  - _需求: 14.1, 14.2, 14.3, 14.4_

- [x] 20. 文档与交付

- [x] 20.1 编写用户文档
  - 创建README.md，包含应用介绍和功能说明
  - 编写用户使用指南
  - 记录已知问题和限制
  - _需求: 13.9_

- [x] 20.2 编写开发文档
  - 记录项目结构和架构说明
  - 记录开发环境搭建步骤
  - 记录构建和部署流程
  - _需求: 所有技术需求_

- [x] 20.3 最终验收测试
  - 在真实Android设备上测试所有功能
  - 验证所有需求是否满足
  - 修复发现的bug
  - 性能验证（启动时间、响应时间、流畅度）
  - _需求: 所有需求_

- [x] 20.4 准备发布
  - 准备应用图标和启动画面
  - 准备应用截图和宣传材料
  - 编写版本更新日志
  - 打包最终版本APK
  - _需求: 16.3_
